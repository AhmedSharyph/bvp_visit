<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Patient Registration</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">

<div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-md">
  <h2 class="text-2xl font-bold mb-4 text-center">Bedridden Patient Registration</h2>

  <form id="regForm" class="space-y-3" onsubmit="event.preventDefault(); registerPatient();">

    <input class="input-field" type="text" id="national_id" placeholder="National ID *" required>
    <input class="input-field" type="text" id="full_name" placeholder="Full Name *" required>
    <input class="input-field" type="date" id="dob" placeholder="Date of Birth">
    <select class="input-field" id="sex">
      <option value="">Select Sex</option>
      <option>Male</option>
      <option>Female</option>
    </select>
    <textarea class="input-field" id="address" placeholder="Address"></textarea>
    <input class="input-field" type="text" id="island" placeholder="Island">
    <input class="input-field" type="tel" id="contact" placeholder="Contact Number">
    <input class="input-field" type="text" id="caregiver_name" placeholder="Caregiver Name">
    <input class="input-field" type="tel" id="caregiver_contact" placeholder="Caregiver Contact">
    <textarea class="input-field" id="remarks" placeholder="Remarks"></textarea>

    <button class="bg-blue-600 text-white py-2 px-4 rounded w-full hover:bg-blue-700 transition" type="submit">
      Register Patient
    </button>

    <p id="status" class="text-center mt-2 text-sm"></p>
  </form>
</div>

<script>
const GAS_URL = "https://script.google.com/macros/s/AKfycbz_TizFmrdtTFslZdHydEaBXhqOkANnNH-NKBWISnlbeCMvZyRecjeCl1wXZpqQYOu1/exec";

function registerPatient() {
  const payload = {
    action: "registerPatient",
    national_id: national_id.value.trim(),
    full_name: full_name.value.trim(),
    dob: dob.value,
    sex: sex.value,
    address: address.value,
    island: island.value,
    contact: contact.value,
    caregiver_name: caregiver_name.value,
    caregiver_contact: caregiver_contact.value,
    remarks: remarks.value
  };

  fetch(GAS_URL, {
    method: "POST",
    body: JSON.stringify(payload)
  })
  .then(r => r.json())
  .then(res => {
    if (res.status === "exists") {
      status.innerText = "⚠ Patient already registered.";
      status.classList.add("text-red-500");
      return;
    }
    status.innerText = "✅ Patient registered successfully!";
    status.classList.remove("text-red-500");
    status.classList.add("text-green-500");

    // Reset form
    document.getElementById("regForm").reset();

    // Redirect to home after 1.5 sec
    setTimeout(() => window.location.href = "index.html", 1500);
  })
  .catch(() => {
    status.innerText = "❌ Network error. Data not sent.";
    status.classList.add("text-red-500");
  });
}
</script>

<style>
.input-field {
  @apply w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-400;
}
</style>
</body>
</html>
